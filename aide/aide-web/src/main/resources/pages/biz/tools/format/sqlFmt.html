<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SQL formatter</title>
</head>
<body>
<div th:fragment="content">
    <ol class="am-breadcrumb">
        <li><a th:href="@{/tools}" class="am-icon-home">工具</a></li>
        <li class="am-active">SQL格式化</li>
    </ol>
    <form class="am-form" disabled="disabled">
        <fieldset>
            <div class="am-form-group am-u-sm-12">
                <label for="sqlText">SQL文本</label>
                <textarea class="" rows="10" id="sqlText"></textarea>
            </div>
            <div class="am-form-group am-u-sm-12">
                <label for="opTypes">操作类型</label>
                <select id="opTypes">
                    <option value="inArgs">参数列表 - IN</option>
                </select>
            </div>
            <div class="am-form-group">
                <div class="am-u-sm-12">

                    <button type="button" class="am-btn am-btn-primary am-btn-sm" id="prettyBtn">格式化</button>
                    <button type="button" class="am-btn am-btn-warning am-btn-sm copy-btn" id="copyBtn"
                            data-am-loading="{spinner: 'circle-o-notch', loadingText: '复制成功'}"
                            data-clipboard-action="copy" data-clipboard-target="#sqlPretty">复制
                    </button>
                </div>
            </div>
            <div class="am-form-group am-u-sm-12">
                <pre class="am-pre-scrollable" style="min-height: 200px;max-height: 500px;" id="sqlPretty"></pre>
            </div>
        </fieldset>
    </form>
    <script>
        require(["jquery", "clipboard", "hljs", "amaze"], function ($, clipboard, hljs, amaze) {
            window['AMUI'] = amaze;
            AMUI.plugin('amSelected', AMUI.selected);
            $('#opTypes').amSelected({
                btnWidth: '200px',
                btnSize: 'sm',
                maxHeight: '200px'
            });
            // 代码高亮
            var sqlFmt = function (txt, type) {
                if (/^\s*$/.test(txt)) {
                    alert('数据为空,无法格式化! ');
                    return;
                }
                if (type == "inArgs") {
                    var toStr = function (str) {
                        if ($.trim(str).indexOf("'") != 0) {
                            return "'" + str + "'";
                        }
                        return str;
                    };
                    var params = txt.split("\n");
                    var result = toStr(params[0]);
                    for (var i = 1; i < params.length; i++) {
                        result += ("," + toStr(params[i]));
                    }
                    $("#sqlPretty").html(result);
                }
                $("pre").each(function (i, block) {
                    hljs.highlightBlock(block);
                })
            };
            $("#prettyBtn").click(function () {
                sqlFmt($("#sqlText").val(), $('#opTypes').val());
            });
            // 复制内容到剪切板
            window['Clipboard'] = clipboard;
            var copy = new Clipboard(".copy-btn");
            copy.on('success', function (e) {
                $("#copyBtn").button('loading');
                setTimeout(function () {
                    $("#copyBtn").button('reset');
                }, 200);
                e.clearSelection();
            });
            copy.on('error', function (e) {
                console.error('Action:', e.action);
                console.error('Trigger:', e.trigger);
            });
        })
    </script>
</div>
</body>
</html>